# 虚拟女友实时语音对话 - 启动说明

## 🚀 快速启动

### 1. 安装依赖
```bash
cd /Users/youngzhou/Downloads/DOUBAO/realtime_dialog
npm install
```

### 2. 启动代理服务器
```bash
npm start
```
服务器将运行在 `http://localhost:8080`

### 3. 打开网页
用浏览器打开 `index.html` 文件，或者通过 `http://localhost:8080` 访问

### 4. 开始对话
- 点击绿色的📞按钮开始通话
- 自动开始录音并发送给小雅
- 实时接收小雅的语音回复
- 再次点击按钮结束通话

## 📱 功能说明

### 通话界面
- **头像区域**: 显示小雅的头像，说话时会有动画效果
- **状态指示**: 显示连接状态（绿色=在线，黄色=连接中，红色=离线）
- **通话计时**: 显示当前通话时长
- **音量条**: 实时显示录音音量
- **操作按钮**: 静音和扬声器控制

### 通话按钮
- **绿色📞**: 点击开始通话
- **红色📞**: 通话中，点击结束通话
- **动画效果**: 通话中会有脉冲动画和涟漪效果

## 🔧 技术特性

### 实时语音处理
- **16kHz PCM录音**: 符合API要求的音频格式
- **连续录音**: 通话期间持续录音发送
- **实时反馈**: 音量可视化和状态更新
- **低延迟**: 使用ScriptProcessorNode实现实时处理

### WebSocket代理
- **代理服务器**: 解决浏览器WebSocket headers限制
- **消息转发**: 透明转发客户端和豆包API之间的消息
- **连接管理**: 自动处理连接建立和断开

### 二进制协议
- **完整实现**: 支持豆包API的所有事件类型
- **消息编解码**: 正确处理协议头、可选字段和payload
- **错误处理**: 完善的错误检测和恢复机制

## 🎯 角色设定

小雅是你的虚拟女友：
- 温柔体贴，善解人意
- 活泼开朗，热爱生活
- 语气自然，就像真实的女朋友
- 会关心你的生活，倾听你的烦恼

## 📝 注意事项

1. **网络要求**: 需要稳定的网络连接
2. **麦克风权限**: 首次使用需要授权麦克风
3. **浏览器兼容**: 推荐使用Chrome、Firefox、Safari最新版本
4. **音频环境**: 建议使用耳机避免回音

## 🆘 故障排除

### 连接失败
- 检查代理服务器是否启动（npm start）
- 确认API密钥配置正确
- 检查网络连接

### 无法录音
- 确认麦克风权限已授权
- 检查浏览器是否支持Web Audio API
- 尝试刷新页面重新授权

### 没有声音
- 检查系统音量设置
- 确认浏览器没有静音
- 检查音频解码是否成功

### 通话中断
- 检查网络连接稳定性
- 查看控制台错误信息
- 重新点击通话按钮重连

## 📂 文件结构

```
realtime_dialog/
├── index.html              # 主页面
├── realtime-client.js      # 前端JavaScript客户端
├── proxy-server.js         # Node.js代理服务器
├── package.json           # Node.js依赖配置
├── 启动说明.md             # 本文档
└── README_WEB.md          # 详细技术文档
```

开始享受与小雅的实时语音对话吧！💕